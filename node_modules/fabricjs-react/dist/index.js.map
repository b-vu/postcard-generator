{"version":3,"file":"index.js","sources":["../src/defaultShapes.tsx","../src/editor.tsx","../src/index.tsx"],"sourcesContent":["export const STROKE = '#000000'\nexport const FILL = 'rgba(255, 255, 255, 0.0)'\n\nexport const CIRCLE = {\n  radius: 20,\n  left: 100,\n  top: 100,\n  fill: FILL,\n  stroke: STROKE\n}\n\nexport const RECTANGLE = {\n  left: 100,\n  top: 100,\n  fill: FILL,\n  stroke: STROKE,\n  width: 40,\n  height: 40,\n  angle: 0\n}\n\nexport const LINE = {\n  points: [50, 100, 200, 200],\n  options: {\n    left: 170,\n    top: 150,\n    stroke: STROKE\n  }\n}\n\nexport const TEXT = {\n  type: 'text',\n  left: 100,\n  top: 100,\n  fontSize: 16,\n  fontFamily: 'Arial',\n  fill: STROKE\n}\n","import { fabric } from 'fabric'\nimport { CIRCLE, RECTANGLE, LINE, TEXT, FILL, STROKE } from './defaultShapes'\nimport { useEffect, useState } from 'react'\n\nexport interface FabricJSEditor {\n  canvas: fabric.Canvas\n  addCircle: () => void\n  addRectangle: () => void\n  addLine: () => void\n  addText: (text: string) => void\n  updateText: (text: string) => void\n  deleteAll: () => void\n  deleteSelected: () => void\n  fillColor: string\n  strokeColor: string\n  setFillColor: (color: string) => void\n  setStrokeColor: (color: string) => void\n  zoomIn: () => void\n  zoomOut: () => void\n}\n\n/**\n * Creates editor\n */\nconst buildEditor = (\n  canvas: fabric.Canvas,\n  fillColor: string,\n  strokeColor: string,\n  _setFillColor: (color: string) => void,\n  _setStrokeColor: (color: string) => void,\n  scaleStep: number\n): FabricJSEditor => {\n  return {\n    canvas,\n    addCircle: () => {\n      const object = new fabric.Circle({\n        ...CIRCLE,\n        fill: fillColor,\n        stroke: strokeColor\n      })\n      canvas.add(object)\n    },\n    addRectangle: () => {\n      const object = new fabric.Rect({\n        ...RECTANGLE,\n        fill: fillColor,\n        stroke: strokeColor\n      })\n      canvas.add(object)\n    },\n    addLine: () => {\n      const object = new fabric.Line(LINE.points, {\n        ...LINE.options,\n        stroke: strokeColor\n      })\n      canvas.add(object)\n    },\n    addText: (text: string) => {\n      // use stroke in text fill, fill default is most of the time transparent\n      const object = new fabric.Textbox(text, { ...TEXT, fill: strokeColor })\n      object.set({ text: text })\n      canvas.add(object)\n    },\n    updateText: (text: string) => {\n      const objects: any[] = canvas.getActiveObjects()\n      if (objects.length && objects[0].type === TEXT.type) {\n        const textObject: fabric.Textbox = objects[0]\n        textObject.set({ text })\n        canvas.renderAll()\n      }\n    },\n    deleteAll: () => {\n      canvas.getObjects().forEach((object) => canvas.remove(object))\n      canvas.discardActiveObject()\n      canvas.renderAll()\n    },\n    deleteSelected: () => {\n      canvas.getActiveObjects().forEach((object) => canvas.remove(object))\n      canvas.discardActiveObject()\n      canvas.renderAll()\n    },\n    fillColor,\n    strokeColor,\n    setFillColor: (fill: string) => {\n      _setFillColor(fill)\n      canvas.getActiveObjects().forEach((object) => object.set({ fill }))\n      canvas.renderAll()\n    },\n    setStrokeColor: (stroke: string) => {\n      _setStrokeColor(stroke)\n      canvas.getActiveObjects().forEach((object) => {\n        if (object.type === TEXT.type) {\n          // use stroke in text fill\n          object.set({ fill: stroke })\n          return\n        }\n        object.set({ stroke })\n      })\n      canvas.renderAll()\n    },\n    zoomIn: () => {\n      const zoom = canvas.getZoom()\n      canvas.setZoom(zoom / scaleStep)\n    },\n    zoomOut: () => {\n      const zoom = canvas.getZoom()\n      canvas.setZoom(zoom * scaleStep)\n    }\n  }\n}\n\ninterface FabricJSEditorState {\n  editor?: FabricJSEditor\n}\n\ninterface FabricJSEditorHook extends FabricJSEditorState {\n  selectedObjects?: fabric.Object[]\n  onReady: (canvas: fabric.Canvas) => void\n}\n\ninterface FabricJSEditorHookProps {\n  defaultFillColor?: string\n  defaultStrokeColor?: string\n  scaleStep?: number\n}\n\nconst useFabricJSEditor = (\n  props: FabricJSEditorHookProps = {}\n): FabricJSEditorHook => {\n  const scaleStep = props.scaleStep || 0.5\n  const { defaultFillColor, defaultStrokeColor } = props\n  const [canvas, setCanvas] = useState<null | fabric.Canvas>(null)\n  const [fillColor, setFillColor] = useState<string>(defaultFillColor || FILL)\n  const [strokeColor, setStrokeColor] = useState<string>(\n    defaultStrokeColor || STROKE\n  )\n  const [selectedObjects, setSelectedObject] = useState<fabric.Object[]>([])\n  useEffect(() => {\n    const bindEvents = (canvas: fabric.Canvas) => {\n      canvas.on('selection:cleared', () => {\n        setSelectedObject([])\n      })\n      canvas.on('selection:created', (e: any) => {\n        setSelectedObject(e.selected)\n      })\n      canvas.on('selection:updated', (e: any) => {\n        setSelectedObject(e.selected)\n      })\n    }\n    if (canvas) {\n      bindEvents(canvas)\n    }\n  }, [canvas])\n\n  return {\n    selectedObjects,\n    onReady: (canvasReady: fabric.Canvas): void => {\n      console.log('Fabric canvas ready')\n      setCanvas(canvasReady)\n    },\n    editor: canvas\n      ? buildEditor(\n          canvas,\n          fillColor,\n          strokeColor,\n          setFillColor,\n          setStrokeColor,\n          scaleStep\n        )\n      : undefined\n  }\n}\n\nexport { buildEditor, useFabricJSEditor, FabricJSEditorHook }\n","import React, { useEffect, useRef } from 'react'\nimport { fabric } from 'fabric'\nimport { useFabricJSEditor, FabricJSEditor, FabricJSEditorHook } from './editor'\n\nexport interface Props {\n  className?: string\n  onReady?: (canvas: fabric.Canvas) => void\n}\n\n/**\n * Fabric canvas as component\n */\nconst FabricJSCanvas = ({ className, onReady }: Props) => {\n  const canvasEl = useRef(null)\n  const canvasElParent = useRef<HTMLDivElement>(null)\n  useEffect(() => {\n    const canvas = new fabric.Canvas(canvasEl.current)\n    const setCurrentDimensions = () => {\n      canvas.setHeight(canvasElParent.current?.clientHeight || 0)\n      canvas.setWidth(canvasElParent.current?.clientWidth || 0)\n      canvas.renderAll()\n    }\n    const resizeCanvas = () => {\n      setCurrentDimensions()\n    }\n    setCurrentDimensions()\n\n    window.addEventListener('resize', resizeCanvas, false)\n\n    if (onReady) {\n      onReady(canvas)\n    }\n\n    return () => {\n      canvas.dispose()\n      window.removeEventListener('resize', resizeCanvas)\n    }\n  }, [])\n  return (\n    <div ref={canvasElParent} className={className}>\n      <canvas ref={canvasEl} />\n    </div>\n  )\n}\n\nexport { FabricJSEditor, FabricJSCanvas, FabricJSEditorHook, useFabricJSEditor }\n"],"names":["STROKE","FILL","CIRCLE","radius","left","top","fill","stroke","RECTANGLE","width","height","angle","LINE","points","options","TEXT","type","fontSize","fontFamily","buildEditor","canvas","fillColor","strokeColor","_setFillColor","_setStrokeColor","scaleStep","addCircle","object","fabric","Circle","add","addRectangle","Rect","addLine","Line","addText","text","Textbox","set","updateText","objects","getActiveObjects","length","textObject","renderAll","deleteAll","getObjects","forEach","remove","discardActiveObject","deleteSelected","setFillColor","setStrokeColor","zoomIn","zoom","getZoom","setZoom","zoomOut","useFabricJSEditor","props","defaultFillColor","defaultStrokeColor","useState","setCanvas","selectedObjects","setSelectedObject","useEffect","bindEvents","on","e","selected","onReady","canvasReady","console","log","editor","undefined","FabricJSCanvas","className","canvasEl","useRef","canvasElParent","Canvas","current","setCurrentDimensions","setHeight","clientHeight","setWidth","clientWidth","resizeCanvas","window","addEventListener","dispose","removeEventListener","React","ref"],"mappings":"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"}